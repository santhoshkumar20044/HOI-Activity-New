<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Function Approval Form</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<style>
:root{
  --teal: #006d77; 
  --teal-dark: #0b6b6a; 
  --card: #fff; 
  --muted: #6b7280; 
  --shadow: 0 16px 40px rgba(0,0,0,0.12);
}
*{box-sizing:border-box}
body{margin:0;font-family:Inter, "Segoe UI", Arial, sans-serif;background:var(--teal);min-height:100vh;color:#032}

/* ---------- HEADER DESIGN ---------- */
header {
    background: #fff;
    padding: 10px 30px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    height: 90px;
    position: sticky;
    top: 0;
    z-index: 1000;
}

.header-left img { height: 65px; width: auto; object-fit: contain; }
.header-right { display: flex; align-items: center; gap: 20px; }

.hoi-pill {
    background: #ffc107; color: #000; padding: 10px 20px; border-radius: 50px; font-weight: 700; font-size: 14px;
    display: flex; align-items: center; gap: 8px; cursor: pointer; border: none; box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    transition: transform 0.2s;
}
.hoi-pill:hover { transform: scale(1.02); background: #ffca2c; }
.hoi-pill i { color: #d32f2f; font-size: 16px; }

.back-btn {
    padding: 8px 20px; border-radius: 50px; border: 1px solid #dee2e6; background: #fff; color: #333;
    font-weight: 600; font-size: 14px; cursor: pointer; display: flex; align-items: center; gap: 6px; transition: background 0.2s;
}
.back-btn:hover { background: #f8f9fa; }

.aakam-logo img { height: 55px; width: auto; }

@media (max-width: 900px) {
    header { height: auto; flex-direction: column; padding: 15px; gap: 15px; }
    .header-right { flex-wrap: wrap; justify-content: center; }
}

/* ---------- FORM LAYOUT ---------- */
.container{max-width:1100px;margin:26px auto;padding:0 18px}
.card{background:var(--card);border-radius:12px;padding:26px;box-shadow:var(--shadow);overflow:auto}
.title{text-align:center;margin-bottom:8px}
.title h1{margin:0;color:var(--teal-dark);font-size:28px;letter-spacing:1px;font-weight:900;text-transform:uppercase}

.row{display:flex;gap:16px}
.col{flex:1}
.grid{display:grid;gap:12px}
.grid-2{grid-template-columns:repeat(2,1fr)}
.grid-4{grid-template-columns:repeat(4,1fr)} /* Added for 4 columns */

label{display:block;margin-bottom:6px;font-weight:700;color:#123}
input[type="text"], input[type="number"], select, textarea, input[type="date"], input[type="time"]{
  width:100%;padding:10px;border-radius:8px;border:1px solid #e6eef0;font-size:14px;background:#fff;
}
textarea{min-height:70px;resize:vertical}
.table{width:100%;border-collapse:collapse;margin-top:8px}
.table td, .table th{border:1px solid #e6eef0;padding:8px;font-size:14px}
.small{font-size:13px;color:#666}
.section{background:#fbfffe;border-radius:10px;padding:14px;border:1px solid #e8f3f3;margin-bottom:14px}
.heading{display:flex;align-items:center;gap:10px;font-weight:900;color:var(--teal-dark);margin-bottom:8px}
.checkbox-inline{display:flex;align-items:center;gap:8px}
.submit-bar{display:flex;justify-content:flex-end;gap:12px;padding-top:8px;border-top:1px dashed #e6f3f3;margin-top:12px}
.btn{padding:10px 14px;border-radius:8px;border:0;font-weight:800;cursor:pointer}
.btn.primary{background:var(--teal-dark);color:#fff}
.btn.ghost{background:#fff;border:1px solid #e6eef0}
.participating-list { display:flex; flex-direction:column; gap:8px; padding:6px 0; }
.participating-list label { font-weight:700; color:#123; display:flex; align-items:center; gap:8px; }
.office-table { width:70%; margin-top:12px; border:1px solid #e6eef0; border-collapse:collapse; background:#fff; }
.office-table th, .office-table td { border:1px solid #e6eef0; padding:8px; }
@media (max-width:980px){ .row{flex-direction:column} .grid-2, .grid-4{grid-template-columns:1fr} .office-table { width:100% } }
</style>
</head>
<body>

<header>
    <div class="header-left">
        <img src="/public/clg-logo.png" alt="Sri Shanmugha Educational Institutions" onerror="this.style.display='none'">
    </div>
    
    <div class="header-right">
        <button class="hoi-pill" id="hoiPill">
            <i class="fas fa-bell"></i> HOI Intervention Needed
        </button>
        
        <button class="back-btn" onclick="history.back()">
            <i class="fas fa-arrow-left"></i> Back
        </button>

        <div class="aakam-logo">
            <img src="/public/aakam-logo.png" alt="aakam360" onerror="this.style.display='none'">
        </div>
    </div>
</header>

<div class="container">
  <div class="card">
    <div class="title"><h1>EVENT APPROVAL FORM</h1></div>

    <form id="functionForm">
      <div class="section">
        <div class="heading"><i class="fas fa-university"></i> Participating College</div>
        <div class="participating-list">
          <label><input type="checkbox" id="pc_institution"> INSTITUTION</label>
          <label><input type="checkbox" id="pc_engineering"> ENGINEERING</label>
          <label><input type="checkbox" id="pc_pharmacy"> PHARMACY</label>
          <label><input type="checkbox" id="pc_nursing"> NURSING</label>
          <label><input type="checkbox" id="pc_hi"> HI</label>
          <label><input type="checkbox" id="pc_ahs"> AHS</label>
          <label><input type="checkbox" id="pc_aakam"> AAKAM360</label>
        </div>

        <div style="margin-top:12px">
          <label>Organizing Department</label>
          <input id="org_department" type="text">
        </div>

        <div class="grid grid-2" style="margin-top:10px">
          <div><label>Activity No</label><input id="activity_no" type="text" placeholder="e.g. ACT-101"></div>
          <div><label>Name of the Event Organizer</label><input id="event_organizer" type="text"></div>
        </div>
        
        <div class="grid grid-2" style="margin-top:10px">
            <div><label>Title / Topic</label><input id="title_topic" type="text"></div>
            <div><label>Guest LinkedIn ID</label><input id="guest_linkedin" type="text" placeholder="https://linkedin.com/in/..."></div>
        </div>

        <div style="margin-top:10px">
          <label>Name of the Chief Guest, Designation and Address</label>
          <textarea id="chief_guest"></textarea>
        </div>

        <div class="grid grid-2" style="margin-top:10px">
          <div><label>Name of the Staff Coordinator</label><input id="staff_coordinator" type="text"></div>
          <div><label>Student Coordinator</label><input id="student_coordinator" type="text"></div>
        </div>

        <div class="grid grid-2" style="margin-top:10px">
          <div><label>Type of the function</label>
            <select id="function_type"><option>Guest Lecture</option><option>Seminar</option><option>Workshop</option><option>Symposium</option><option>Conference</option><option>General</option></select>
          </div>
          <div><label>Level of the function</label>
            <select id="function_level"><option>Department</option><option>Institution</option><option>State</option><option>National</option><option>International</option></select>
          </div>
        </div>

        <div class="grid grid-2" style="margin-top:10px">
          <div><label>Type of Participants</label><input id="participants_type" type="text" placeholder="Students / Faculty / Industry"></div>
          <div class="row" style="align-items:center">
            <div style="flex:1"><label>No. Students</label><input id="num_students" type="number"></div>
            <div style="flex:1"><label>No. Faculty</label><input id="num_faculty" type="number"></div>
          </div>
        </div>

        <div class="grid grid-2" style="margin-top:10px">
          <div><label>Number of Days</label><input id="num_days" type="number"></div>
          <div class="row" style="align-items:center">
            <div style="flex:1"><label>Date</label><input id="event_date" type="date"></div>
            <div style="flex:1"><label>Time</label><input id="event_time" type="time"></div>
          </div>
        </div>

        <div class="grid grid-2" style="margin-top:10px">
          <div><label>Venue</label>
            <select id="venue"><option>Shanmugha Convention Centre</option><option>A-Block Seminar Hall</option><option>Others</option></select>
          </div>
          <div><label>Audio (No. of mics)</label><input id="no_mics" type="number" placeholder="Count"></div>
        </div>

        <div class="grid grid-2" style="margin-top:10px">
          <div><label>Whiteboard</label><select id="whiteboard"><option>Needed</option><option>Not Needed</option></select></div>
          <div><label>Recording Mode</label><select id="recording_mode"><option>Photo</option><option>Video</option><option>Both</option></select></div>
        </div>

        <div style="margin-top:10px">
          <label>AC Requirement</label>
          <div class="checkbox-inline">
            <label><input type="radio" name="ac" value="Required" checked> Required</label>
            <label><input type="radio" name="ac" value="Not Required"> Not Required</label>
          </div>
        </div>
      </div>

      <div class="section">
        <div class="heading"><i class="fas fa-clipboard-list"></i> CHECK LIST â€” BEFORE FUNCTION</div>
        <p class="small">Fill Name of staff (I/C), Status (Yes/No), Date</p>
        <table class="table" id="beforeTable">
          <thead><tr><th style="width:40px">S.No.</th><th>Activities</th><th style="width:220px">Name of staff (I/C)</th><th style="width:120px">Status</th><th style="width:140px">Date</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>

      <div class="section">
        <div class="heading"><i class="fas fa-bell"></i> ON THE DAY â€” ACTIVITIES</div>
        <div class="grid grid-2">
          <div><label>Receiving Guest</label><input id="on_day_receive" type="text"></div>
          <div><label>Lift Incharge</label><input id="on_day_lift" type="text"></div>
        </div>
        <div class="grid grid-2" style="margin-top:10px">
          <div><label>Guest Book Sign</label><input id="on_day_guestbook" type="text"></div>
          <div><label>Video Byte</label><input id="on_day_videobyte" type="text"></div>
        </div>
        <div class="grid grid-2" style="margin-top:10px">
          <div><label>Social Media Post</label><input id="on_day_social" type="text"></div>
          <div><label>Report/Website Update</label><input id="on_day_report" type="text"></div>
        </div>
      </div>

      <div class="section">
        <div class="heading"><i class="fas fa-money-bill"></i> BUDGET / EXPENDITURE</div>
        <table class="table">
          <thead><tr><th style="width:40px">S.No.</th><th>Items</th><th style="width:140px">Estimated (INR)</th><th style="width:140px">Actual (INR)</th><th>Remarks</th></tr></thead>
          <tbody>
            <tr><td>1</td><td>Reception, Bouquet, Garland</td><td><input id="e1_est" type="number"></td><td><input id="e1_act" type="number"></td><td><input id="e1_rem" type="text"></td></tr>
            <tr><td>2</td><td>Rangoli</td><td><input id="e2_est" type="number"></td><td><input id="e2_act" type="number"></td><td><input id="e2_rem" type="text"></td></tr>
            <tr><td>3</td><td>Honorarium</td><td><input id="e3_est" type="number"></td><td><input id="e3_act" type="number"></td><td><input id="e3_rem" type="text"></td></tr>
            <tr><td>4</td><td>Travel Allowance</td><td><input id="e4_est" type="number"></td><td><input id="e4_act" type="number"></td><td><input id="e4_rem" type="text"></td></tr>
            <tr><td colspan="2"><strong>Total</strong></td><td><input id="total_est" type="text" readonly></td><td><input id="total_act" type="text" readonly></td><td></td></tr>
          </tbody>
        </table>
      </div>

      <div class="section">
        <div class="heading"><i class="fas fa-hand-holding-dollar"></i> SOURCE OF FUNDS</div>
        <div class="grid grid-2">
          <div><label>Association (INR)</label><input id="s1" type="number"></div>
          <div><label>Registration fees (INR)</label><input id="s2" type="number"></div>
        </div>
        <div class="grid grid-2" style="margin-top:10px">
          <div><label>Grants / Sponsorship (INR)</label><input id="s3" type="number"></div>
          <div><label>Management (INR)</label><input id="s4" type="number"></div>
        </div>
        <div style="margin-top:10px"><label>Any other (INR)</label><input id="s5" type="number"></div>
        <div style="margin-top:8px"><label>Total (auto)</label><input id="fund_total" type="text" readonly></div>
      </div>

      <div class="submit-bar">
        <button type="button" class="btn ghost" onclick="document.getElementById('functionForm').reset()">Reset</button>
        <button type="button" class="btn primary" onclick="submitForm()">Submit Approval Request</button>
      </div>

    </form>
  </div>
</div>

<script>
/* Generate Checklist Rows */
(function generateBeforeRows(){
  const activities = [
    "Info to Participants", "Info to Newspaper", "Info to Website Coord", "Invitation Sent",
    "Hall Arrangement/Memento", "Signage Board", "Tree Plantation", "Photo/Video Incharge",
    "Agenda", "Flex", "Reception", "Hospitality (Food/Water)", "Guest Room", "Guest Vehicle", "Accompanying Person"
  ];
  const tbody = document.querySelector('#beforeTable tbody');
  tbody.innerHTML = '';
  for(let i=0;i<activities.length;i++){
    const idx = i+1;
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${idx}</td><td>${activities[i]}</td><td><input id="b${idx}_staff" type="text"></td><td><select id="b${idx}_status"><option>Yes</option><option>No</option></select></td><td><input id="b${idx}_date" type="date"></td>`;
    tbody.appendChild(tr);
  }
})();

function $(id){ return document.getElementById(id); }
function numVal(id){ const v=parseFloat((document.getElementById(id)||{}).value); return isNaN(v)?0:v; }

/* Totals */
function calcTotals(){
  const est = numVal('e1_est') + numVal('e2_est') + numVal('e3_est') + numVal('e4_est');
  const act = numVal('e1_act') + numVal('e2_act') + numVal('e3_act') + numVal('e4_act');
  $('total_est').value = est || 0;
  $('total_act').value = act || 0;
  
  const funds = numVal('s1') + numVal('s2') + numVal('s3') + numVal('s4') + numVal('s5');
  $('fund_total').value = funds || 0;
}
['e1_est','e2_est','e3_est','e4_est','e1_act','e2_act','e3_act','e4_act','s1','s2','s3','s4','s5'].forEach(id=>{
  const el=document.getElementById(id); if(el) el.addEventListener('input', calcTotals);
});

/* SUBMIT LOGIC */
async function submitForm(){
  calcTotals();
  
  // 1. Collect Data
  const getChecked = (ids) => ids.map(id => $(id)?.checked ? $(id).parentElement.textContent.trim() : null).filter(Boolean).join(', ');
  const colleges = getChecked(['pc_institution','pc_engineering','pc_pharmacy','pc_nursing','pc_hi','pc_ahs','pc_aakam']);
  
  const dept = $('org_department').value;
  const organizer = $('event_organizer').value;
  const title = $('title_topic').value;
  const date = $('event_date').value;
  const type = $('function_type').value;
  const budgetEst = $('total_est').value;
  const actNo = $('activity_no').value;
  const linkedin = $('guest_linkedin').value;
  
  // 2. Description
  let desc = `Act No: ${actNo}. Title: ${title} (${type}). Org: ${organizer} (${dept}). Guest LinkedIn: ${linkedin}. Date: ${date}. `;
  if(colleges) desc += `Colleges: ${colleges}. `;
  desc += `Est Budget: â‚¹${budgetEst}.`;

  const payload = {
    title: "Function Approval Request",
    description: desc,
    status: 'new',
    timestamp: new Date()
  };

  // 3. Send to Backend
  try {
    const response = await fetch('http://localhost:5000/api/submit', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });

    if (response.ok) {
      alert("âœ… Function Approval Request Submitted Successfully!");
      window.location.reload();
    } else {
      alert("âŒ Failed to submit request.");
    }
  } catch (error) {
    console.error(error);
    alert("âŒ Server Error: Is backend running?");
  }
}

/* HOI Action */
document.getElementById('hoiPill').addEventListener('click', ()=>{
  const topic = prompt('Enter Issue for HOI Intervention:');
  if(topic) alert('ðŸš¨ HOI Intervention Alert Sent!');
});
</script>

</body>
</html>