<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Aakam SHINE ‚Äî Monthly Incubation Report</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<style>
  :root{ --teal:#0b6b67; --teal-2:#0f766e; --muted:#6b7280; --card:#fff; --radius:12px; --shadow:0 14px 40px rgba(2,38,38,0.08); --maxw:1200px; }
  *{box-sizing:border-box}
  body{ margin:0; font-family:Inter,"Segoe UI",Arial,sans-serif; background:linear-gradient(180deg,var(--teal) 0%, #0a6a69 40%, #0a6a69 100%); color:#032; min-height:100vh; }
  
  /* Header */
  header{ background:#fff; padding:12px 24px; display:flex; align-items:center; justify-content:space-between; box-shadow:0 6px 18px rgba(0,0,0,0.06); position: sticky; top: 0; z-index: 100; }
  .header-left img{height:56px}
  .header-right{display:flex;align-items:center;gap:12px}
  
  .hoi-pill{ background:linear-gradient(180deg,#ffd966,#ffca28); padding:8px 14px; border-radius:999px; font-weight:800; color:#5a3f00; display:inline-flex; align-items:center; gap:8px; cursor:pointer; transition: transform 0.2s; }
  .hoi-pill:hover { transform: scale(1.05); }
  
  .back-btn{ padding:8px 16px; border-radius:999px; border:1px solid #e6eef0; background:#fff; cursor:pointer; font-weight: 600; display: flex; align-items: center; gap: 5px; }
  .back-btn:hover { background: #f8f9fa; }

  /* Container */
  .container{max-width:var(--maxw);margin:24px auto;padding:0 18px}
  .card{ background:var(--card); border-radius:14px; padding:28px; box-shadow:var(--shadow); overflow:auto; }

  /* Typography */
  .title{text-align:center;margin-bottom:20px}
  .title h1{ margin:0; color:var(--teal-2); font-size:28px; letter-spacing:1px; font-weight:900; text-transform: uppercase; }
  
  /* Sections */
  .section{margin-top:24px}
  .section .heading{ display:flex; align-items:center; gap:10px; font-weight:900; color:var(--teal-2); margin-bottom:12px; font-size:18px; border-bottom: 2px solid #e6f7f3; padding-bottom: 8px; }
  .block{ background:#fbfffe; border-radius:10px; padding:20px; border:1px solid #e8f3f3; }
  
  /* Grid & Inputs */
  .grid{display:grid;gap:16px}
  .grid-2{grid-template-columns:repeat(2,1fr)}
  label{display:block;margin-bottom:6px;font-weight:700;color:#123; font-size: 14px;}
  
  input[type="text"],input[type="number"],select,textarea,input[type="date"],input[type="time"]{
    width:100%; padding:12px; border-radius:8px; border:1px solid #cbd5e1; font-size:14px; background:#fff; transition: border 0.3s;
  }
  input:focus, select:focus, textarea:focus { outline: none; border-color: var(--teal-2); box-shadow: 0 0 0 3px rgba(15, 118, 110, 0.1); }
  textarea{min-height:80px;resize:vertical}
  .small{font-size:13px;color:#666}

  /* Dynamic Lists */
  .dynamic-list{ border:1px dashed #94a3b8; padding:15px; border-radius:8px; background: #f8fafc; margin-top: 10px; }
  .dyn-row{ display:flex; flex-wrap:wrap; gap:10px; align-items:flex-start; margin-bottom:15px; padding-bottom: 15px; border-bottom: 1px solid #e2e8f0; }
  .dyn-row:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }
  .dyn-row input, .dyn-row select, .dyn-row textarea{ flex:1; min-width: 150px; }

  /* Buttons */
  .actions{ display:flex; justify-content:flex-end; align-items:center; margin-top:30px; gap:15px; border-top: 1px solid #eee; padding-top: 20px; }
  .btn{ padding:12px 24px; border-radius:8px; border:0; font-weight:800; cursor:pointer; transition: all 0.2s; font-size: 15px; display: flex; align-items: center; gap: 8px; }
  .btn.primary{background:var(--teal-2);color:#fff; box-shadow: 0 4px 6px rgba(15, 118, 110, 0.2); }
  .btn.primary:hover{ background: #0d615b; transform: translateY(-1px); }
  .btn.ghost{background:#fff;border:1px solid #cbd5e1; color: #475569; }
  .btn.ghost:hover{ background: #f1f5f9; }
  .btn.danger{ background: #fee2e2; color: #b91c1c; border: 1px solid #fecaca; padding: 8px 12px; font-size: 13px; }
  .btn.danger:hover{ background: #fca5a5; }

  /* Responsive */
  @media (max-width:980px){ .grid-2{grid-template-columns:1fr} .dyn-row{flex-direction:column;align-items:stretch} }
</style>
</head>
<body>

<header>
  <div class="header-left">
    <img src="/public/clg-logo.png" alt="logo" onerror="this.style.display='none'">
  </div>
  <div class="header-right">
    <div class="hoi-pill" onclick="triggerHOI()">
      <i class="fas fa-exclamation-circle"></i> HOI Intervention
    </div>
    <button class="back-btn" onclick="history.back()">
      <i class="fas fa-arrow-left"></i> Back
    </button>
    <img src="/public/aakam-logo.png" alt="aakam" style="height:56px" onerror="this.style.display='none'">
  </div>
</header>

<div class="container">
  <div class="card">
    <div class="title">
      <h1>Aakam SHINE ‚Äî Monthly Incubation Report</h1>
    </div>

    <form id="aakamForm">

      <div class="section">
        <div class="heading"><i class="fas fa-user-tie"></i> SECTION 1 ‚Äî Reporter & Period</div>
        <div class="block">
          <div class="grid grid-2">
            <div>
              <label>Report Month *</label>
              <select id="report_month">
                <option value="Current">Current Month</option>
                <option>Jan</option><option>Feb</option><option>Mar</option><option>Apr</option>
                <option>May</option><option>Jun</option><option>Jul</option><option>Aug</option>
                <option>Sep</option><option>Oct</option><option>Nov</option><option>Dec</option>
              </select>
            </div>
            <div>
              <label>Report Year *</label>
              <select id="report_year">
                <option value="2025">2025</option><option>2024</option><option>2026</option>
              </select>
            </div>
            <div><label>Reporter Name</label><input id="reporter_name" type="text" placeholder="Full Name"></div>
            <div><label>Designation</label><input id="designation" type="text"></div>
          </div>
        </div>
      </div>

      <div class="section">
        <div class="heading"><i class="fas fa-chart-pie"></i> SECTION 2 ‚Äî Executive Summary</div>
        <div class="block">
          <label>Short summary of this month</label>
          <textarea id="exec_summary" placeholder="Brief highlights..."></textarea>
          <div class="grid grid-2" style="margin-top:12px">
            <div><label>Key KPIs Achieved</label><input id="top_kpis" type="text" placeholder="e.g., 5 new startups"></div>
            <div><label>Major Challenges</label><input id="top_challenges" type="text"></div>
          </div>
        </div>
      </div>

      <div class="section">
        <div class="heading"><i class="fas fa-tachometer-alt"></i> SECTION 3 ‚Äî Key Statistics</div>
        <div class="block">
          <div class="grid grid-2">
            <div><label>Active Startups</label><input id="total_active_startups" type="number"></div>
            <div><label>New Onboarded (This Month)</label><input id="new_startups_month" type="number"></div>
            <div><label>Events Conducted</label><input id="events_conducted" type="number"></div>
            <div><label>Grants Received (INR)</label><input id="grants_received" type="number"></div>
          </div>
        </div>
      </div>

      <div class="section">
        <div class="heading">
            <i class="fas fa-rocket"></i> SECTION 4 ‚Äî Startup Details
            <button type="button" class="btn ghost" style="margin-left:auto; padding:6px 12px; font-size:12px;" onclick="addStartup()">+ Add Startup</button>
        </div>
        <div class="block">
            <div id="startupsList" class="dynamic-list"></div>
        </div>
      </div>

      <div class="section">
        <div class="heading">
            <i class="fas fa-calendar-check"></i> SECTION 5 ‚Äî Events & Activities
            <button type="button" class="btn ghost" style="margin-left:auto; padding:6px 12px; font-size:12px;" onclick="addEvent()">+ Add Event</button>
        </div>
        <div class="block">
            <div id="eventsList" class="dynamic-list"></div>
        </div>
      </div>

      <div class="section">
        <div class="heading">
            <i class="fas fa-chalkboard-teacher"></i> SECTION 6 ‚Äî Mentorship
            <button type="button" class="btn ghost" style="margin-left:auto; padding:6px 12px; font-size:12px;" onclick="addMentor()">+ Add Mentor</button>
        </div>
        <div class="block">
            <div id="mentorsList" class="dynamic-list"></div>
        </div>
      </div>

      <div class="section">
        <div class="heading"><i class="fas fa-upload"></i> SECTION 7 ‚Äî Supporting Documents</div>
        <div class="block">
          <label>Upload any consolidated reports / photos</label>
          <input id="master_upload" type="file" multiple>
        </div>
      </div>

      <div class="actions">
        <button type="button" class="btn ghost" onclick="resetForm()">Reset Form</button>
        <button type="button" class="btn primary" onclick="submitReport()">
            <i class="fas fa-paper-plane"></i> Submit Report
        </button>
      </div>

    </form>
  </div>
</div>

<script>
    // --- UTILITIES ---
    const $ = id => document.getElementById(id);
    const getVal = id => $(id)?.value || '';
    
    // --- DYNAMIC ROWS ---
    const mentorsList = $('mentorsList');
    const startupsList = $('startupsList');
    const eventsList = $('eventsList');

    function createRow(container, html) {
        const div = document.createElement('div');
        div.className = 'dyn-row';
        div.innerHTML = html;
        div.querySelector('.delete-btn').addEventListener('click', () => div.remove());
        container.appendChild(div);
    }

    function addStartup() {
        const html = `
            <input type="text" class="s_name" placeholder="Startup Name">
            <select class="s_stage"><option value="">Stage</option><option>Idea</option><option>MVP</option><option>Revenue</option></select>
            <input type="text" class="s_founder" placeholder="Founder Name">
            <input type="number" class="s_revenue" placeholder="Rev (‚Çπ)">
            <button type="button" class="btn danger delete-btn">X</button>
        `;
        createRow(startupsList, html);
    }

    function addEvent() {
        const html = `
            <input type="text" class="e_name" placeholder="Event Name">
            <input type="date" class="e_date">
            <input type="number" class="e_participants" placeholder="Participants">
            <button type="button" class="btn danger delete-btn">X</button>
        `;
        createRow(eventsList, html);
    }

    function addMentor() {
        const html = `
            <input type="text" class="m_name" placeholder="Mentor Name">
            <input type="text" class="m_topic" placeholder="Topic/Domain">
            <input type="number" class="m_hours" placeholder="Hours">
            <button type="button" class="btn danger delete-btn">X</button>
        `;
        createRow(mentorsList, html);
    }

    // Initialize with one row each
    addStartup();
    addEvent();
    addMentor();

    // --- COLLECT DATA HELPERS ---
    function getDynamicData(container, selectors) {
        const rows = container.querySelectorAll('.dyn-row');
        return Array.from(rows).map(row => {
            let obj = {};
            selectors.forEach(sel => {
                const key = sel.replace('.', ''); // simple key from class name
                obj[key] = row.querySelector(sel)?.value || '';
            });
            return obj;
        });
    }

    function resetForm() {
        if(confirm("Clear all data?")) document.getElementById('aakamForm').reset();
    }

    function triggerHOI() {
        alert("üö® HOI Intervention Alert has been flagged!");
    }

    // --- SUBMIT LOGIC ---
    async function submitReport() {
        // 1. Basic Info
        const month = getVal('report_month');
        const year = getVal('report_year');
        const reporter = getVal('reporter_name');
        
        // 2. Dynamic Data strings
        const startups = getDynamicData(startupsList, ['.s_name', '.s_stage', '.s_revenue']);
        const events = getDynamicData(eventsList, ['.e_name', '.e_participants']);
        
        // 3. Construct Description
        let desc = `Period: ${month} ${year}. Reporter: ${reporter}. \n`;
        desc += `Summary: ${getVal('exec_summary')}. \n`;
        desc += `Startups Active: ${getVal('total_active_startups')}. New: ${getVal('new_startups_month')}. \n`;
        desc += `Events: ${getVal('events_conducted')}. Grants: ‚Çπ${getVal('grants_received')}. \n`;
        
        // Add lists summary to description
        const startupNames = startups.map(s => s.s_name).filter(Boolean).join(', ');
        if(startupNames) desc += `Startups List: ${startupNames}. `;

        // 4. File Info
        const fileInput = $('master_upload');
        if(fileInput.files.length > 0) {
            desc += `\n[Files Attached: ${fileInput.files.length} files]`;
        }

        const payload = {
            title: "Incubation Activity Report",
            description: desc,
            status: 'new',
            timestamp: new Date()
        };

        console.log("üöÄ Sending Payload:", payload);

        try {
            const response = await fetch('http://localhost:5000/api/submit', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (response.ok) {
                alert("‚úÖ Incubation Report Submitted Successfully!");
                window.location.reload();
            } else {
                alert("‚ùå Failed to submit report.");
            }
        } catch (error) {
            console.error(error);
            alert("‚ùå Server Error: Is backend running?");
        }
    }
</script>

</body>
</html>